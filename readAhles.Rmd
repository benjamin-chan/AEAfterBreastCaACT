# Read Ahles

Read data from 
[Ahles TA, et al.](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2988635/)
"Longitudinal Assessment of Cognitive Changes Associated With Adjuvant Treatment for Breast Cancer: Impact of Age and Cognitive Reserve."
*J Clin Oncol.* 
2010 Oct 10; 28(29): 4434-4440.

Data file was requested and received from the co-author, [Yuelin Li](https://www.mskcc.org/profile/yuelin-li), in October 2015.

Read data file (text format).

```{r}
path <- "StudyDocuments/CognitiveImpairment"
# list.files(path)
f <- sprintf("%s/%s", path, "Soulsby_means.txt")
D <- fread(f, sep="|")
```

Study design.

```{r}
D[, .(nrows = .N, totalN = sum(N)), .(txgrp, ptime)]
```

Instruments.

```{r}
D[, .N, .(Variable, Label)]
```

Merge Kathleen's <KVanDyk@mednet.ucla.edu> domain assignments.

```
From: Van Dyk, Kathleen [KVanDyk@mednet.ucla.edu]
Sent: Tuesday, November 03, 2015 5:08 PM
To: Ayse Tezcan
Cc: Benjamin Chan
Subject: RE: Cognitive impairment draft paper

Hi,
 
Attached is the Ono spreadsheet with a new column with my suggestions for
domains and domains for each Ahles test is in sheet 2.  I've highlighted tests
that we may want to exclude if we want to consistently keep one or two
measures per test.  Ben --- does it matter statistically if there is more than
one measure from the same test (for example delayed recall and delayed
recognition) in the same domain?  In almost every case we have total and delay
for memory tests but if we add in more measures (Trial 6, Supraspan,
Recognition) does this confound analyses because these are likely highly
correlated measures within the same test?  Would all of the studies need to
use the same measures in each test (i.e., every study uses Total and Delay)?
I might not be asking this clearly --- let me know what you think.
```

```{r}
url <- "https://docs.google.com/spreadsheets/d/1DsR3lDMu5gFUOGI4G_pS6bI_lBKzXz1i4_OLr2poyCc/edit?usp=sharing"
gs_auth()
gs_url(url)
D0 <- gs_read(gs_url(url), ws=2)
D0 <- data.table(D0)
CognitiveDomainForMetaAnalysis <- D0[!is.na(DOMAIN.FOR.META..kvd.), DOMAIN.FOR.META..kvd.]
lookup <- cbind(D[, .N, .(Variable, Label)], CognitiveDomainForMetaAnalysis)[, .(Variable, CognitiveDomainForMetaAnalysis)]
D <- merge(lookup, D, by="Variable")
```

Restructure data to mimic the structure of the Ono data.

**To do**

* Map `ptime` to `timeDays`

```{r}
D <- D[,
       `:=` (author = "Ahles",
             # ptime = ,  # Map ptime to timeDays
             NObs = NULL,
             Median = NULL)]
D <- D[grepl("z_adj", Variable), ScoreTyp := "z score"]
D <- D[, Variable := NULL]
D[, .N, ScoreTyp]
D1 <- D[txgrp == "control"]
D1 <- D1[,
         `:=` (healthyGroup = 1,
               txgrp = NULL)]
setnames(D1,
         c("Label", "N", "Mean", "StdDev"),
         c("CogTest", "nGroup1", "meanGroup1", "sdGroup1"))
D2 <- D[txgrp == "chemo"]
setnames(D2,
         c("txgrp", "Label", "N", "Mean", "StdDev"),
         c("treatmentGroup", "CogTest", "nGroup2", "meanGroup2", "sdGroup2"))
DAhles <- merge(D1,
                D2,
                by=intersect(names(D1), names(D2)))
D2 <- D[txgrp == "chemo no"]
setnames(D2,
         c("txgrp", "Label", "N", "Mean", "StdDev"),
         c("treatmentGroup", "CogTest", "nGroup2", "meanGroup2", "sdGroup2"))
DAhles <- rbind(DAhles,
                merge(D1,
                      D2,
                      by=intersect(names(D1), names(D2))))
setcolorder(DAhles,
            c("author",
              "healthyGroup",
              "treatmentGroup",
              "ptime",
              "nGroup1",
              "nGroup2",
              "meanGroup1",
              "sdGroup1",
              "meanGroup2",
              "sdGroup2",
              "CogTest",
              "CognitiveDomainForMetaAnalysis",
              "ScoreTyp"))
setorder(DAhles,
         treatmentGroup,
         ptime,
         CognitiveDomainForMetaAnalysis)
D <- DAhles
```

Calculate fixed effect sizes, `weightFE`.

```{r}
# D <- D[direction == "Lower worse",
#        `:=` (diffMean = meanGroup2 - meanGroup1)]
# D <- D[direction == "Greater worse",
#        `:=` (diffMean = meanGroup1 - meanGroup2)]
D <- D[,
       `:=` (diffMean = meanGroup2 - meanGroup1)]
D <- D[,
       `:=` (sdPooled = sqrt((((nGroup1 - 1) * (sdGroup1 ^ 2)) +
                                ((nGroup2 - 1) * (sdGroup2 ^ 2))) /
                               (nGroup1 + nGroup2 - 2)))]
D <- D[,
       `:=` (cohenD = diffMean / sdPooled,
             nTotal = nGroup1 + nGroup2)]
D <- D[,
       `:=` (hedgesG = cohenD * (1 - (3 / ((4 * nTotal) - 9))))]
D <- D[,
       `:=` (var1 = (nGroup1 + nGroup2) / (nGroup1 * nGroup2),
             var2 = hedgesG ^ 2 / (2 * (nGroup1 + nGroup2)))]
D <- D[,
       `:=` (variance = var1 + var2)]
D <- D[,
       `:=` (se = sqrt(variance),
             weightFE = 1 / variance)]
D <- D[,
       `:=` (effSizeWeightedFE = weightFE * hedgesG)]
# D <- D[, weightRE := 1 / (variance + randomEffect)]
# D <- D[, effSizeWeightedRE := weightRE * hedgesG]
```

Save working data tables to file.

```{r}
metadata = makeMetadata(D)
f <- "Ahles.RData"
save(D, metadata, file=f)
message(sprintf("%s saved on: %s\nFile size: %s KB", 
                f,
                file.mtime(f),
                file.size(f) / 1e3))
```
